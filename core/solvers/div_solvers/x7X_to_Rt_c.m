function [F, c, H, R, t] = x7X_to_Rt_c(x, y, X, Y)
    c = mean([x;y;X;Y],2);
    x0 = x - c(1); y0 = y - c(2);
    X0 = X - c(3); Y0 = Y - c(4);
    s = sqrt(mean([x0.^2+y0.^2; X0.^2+Y0.^2]/2,2));
    x0 = x0 ./ s(1);
    y0 = y0 ./ s(1);
    X0 = X0 ./ s(2);
    Y0 = Y0 ./ s(2);
    Tx = [diag(ones(1,2)./s(1)) -c(1:2)/s(1); 0 0 1];
    invTx = [diag(ones(1,2).*s(1)) c(1:2); 0 0 1];
    TX = [diag(ones(1,2)./s(2)) -c(3:4)/s(2); 0 0 1];
    invTX = [diag(ones(1,2).*s(2)) -c(3:4); 0 0 1];
    c = [];

    M = [x0.*X0; x0.*Y0; x0;...
        y0.*X0; y0.*Y0; y0;...
        X0; Y0; ones(size(X))];
    [U,s,V] = svd(M');
    v = V(:,end-1:end);

    c0 = v(1,2)*v(5,2)*v(9,2) - v(1,2)*v(6,2)*v(8,2) - v(2,2)*v(4,2)*v(9,2) + v(2,2)*v(6,2)*v(7,2) + v(3,2)*v(4,2)*v(8,2) - v(3,2)*v(5,2)*v(7,2);

    c1 = v(1,1)*v(5,2)*v(9,2) - v(1,1)*v(6,2)*v(8,2) + v(1,2)*v(5,1)*v(9,2) + v(1,2)*v(5,2)*v(9,1) - v(1,2)*v(6,1)*v(8,2) - v(1,2)*v(6,2)*v(8,1) - v(2,1)*v(4,2)*v(9,2) + v(2,1)*v(6,2)*v(7,2) - v(2,2)*v(4,1)*v(9,2) - v(2,2)*v(4,2)*v(9,1) + v(2,2)*v(6,1)*v(7,2) + v(2,2)*v(6,2)*v(7,1) + v(3,1)*v(4,2)*v(8,2) - v(3,1)*v(5,2)*v(7,2) + v(3,2)*v(4,1)*v(8,2) + v(3,2)*v(4,2)*v(8,1) - v(3,2)*v(5,1)*v(7,2) - v(3,2)*v(5,2)*v(7,1) - 3*v(1,2)*v(5,2)*v(9,2) + 3*v(1,2)*v(6,2)*v(8,2) + 3*v(2,2)*v(4,2)*v(9,2) - 3*v(2,2)*v(6,2)*v(7,2) - 3*v(3,2)*v(4,2)*v(8,2) + 3*v(3,2)*v(5,2)*v(7,2);

    c2 = v(1,1)*v(5,1)*v(9,2) + v(1,1)*v(5,2)*v(9,1) - v(1,1)*v(6,1)*v(8,2) - v(1,1)*v(6,2)*v(8,1) + v(1,2)*v(5,1)*v(9,1) - v(1,2)*v(6,1)*v(8,1) - v(2,1)*v(4,1)*v(9,2) - v(2,1)*v(4,2)*v(9,1) + v(2,1)*v(6,1)*v(7,2) + v(2,1)*v(6,2)*v(7,1) - v(2,2)*v(4,1)*v(9,1) + v(2,2)*v(6,1)*v(7,1) + v(3,1)*v(4,1)*v(8,2) + v(3,1)*v(4,2)*v(8,1) - v(3,1)*v(5,1)*v(7,2) - v(3,1)*v(5,2)*v(7,1) + v(3,2)*v(4,1)*v(8,1) - v(3,2)*v(5,1)*v(7,1) - 2*v(1,1)*v(5,2)*v(9,2) + 2*v(1,1)*v(6,2)*v(8,2) - 2*v(1,2)*v(5,1)*v(9,2) - 2*v(1,2)*v(5,2)*v(9,1) + 2*v(1,2)*v(6,1)*v(8,2) + 2*v(1,2)*v(6,2)*v(8,1) + 2*v(2,1)*v(4,2)*v(9,2) - 2*v(2,1)*v(6,2)*v(7,2) + 2*v(2,2)*v(4,1)*v(9,2) + 2*v(2,2)*v(4,2)*v(9,1) - 2*v(2,2)*v(6,1)*v(7,2) - 2*v(2,2)*v(6,2)*v(7,1) - 2*v(3,1)*v(4,2)*v(8,2) + 2*v(3,1)*v(5,2)*v(7,2) - 2*v(3,2)*v(4,1)*v(8,2) - 2*v(3,2)*v(4,2)*v(8,1) + 2*v(3,2)*v(5,1)*v(7,2) + 2*v(3,2)*v(5,2)*v(7,1) + 3*v(1,2)*v(5,2)*v(9,2) - 3*v(1,2)*v(6,2)*v(8,2) - 3*v(2,2)*v(4,2)*v(9,2) + 3*v(2,2)*v(6,2)*v(7,2) + 3*v(3,2)*v(4,2)*v(8,2) - 3*v(3,2)*v(5,2)*v(7,2);

    c3 = v(1,1)*v(5,1)*v(9,1) - v(1,1)*v(6,1)*v(8,1) - v(2,1)*v(4,1)*v(9,1) + v(2,1)*v(6,1)*v(7,1) + v(3,1)*v(4,1)*v(8,1) - v(3,1)*v(5,1)*v(7,1) - v(1,1)*v(5,1)*v(9,2) - v(1,1)*v(5,2)*v(9,1) + v(1,1)*v(6,1)*v(8,2) + v(1,1)*v(6,2)*v(8,1) - v(1,2)*v(5,1)*v(9,1) + v(1,2)*v(6,1)*v(8,1) + v(2,1)*v(4,1)*v(9,2) + v(2,1)*v(4,2)*v(9,1) - v(2,1)*v(6,1)*v(7,2) - v(2,1)*v(6,2)*v(7,1) + v(2,2)*v(4,1)*v(9,1) - v(2,2)*v(6,1)*v(7,1) - v(3,1)*v(4,1)*v(8,2) - v(3,1)*v(4,2)*v(8,1) + v(3,1)*v(5,1)*v(7,2) + v(3,1)*v(5,2)*v(7,1) - v(3,2)*v(4,1)*v(8,1) + v(3,2)*v(5,1)*v(7,1) + v(1,1)*v(5,2)*v(9,2) - v(1,1)*v(6,2)*v(8,2) + v(1,2)*v(5,1)*v(9,2) + v(1,2)*v(5,2)*v(9,1) - v(1,2)*v(6,1)*v(8,2) - v(1,2)*v(6,2)*v(8,1) - v(2,1)*v(4,2)*v(9,2) + v(2,1)*v(6,2)*v(7,2) - v(2,2)*v(4,1)*v(9,2) - v(2,2)*v(4,2)*v(9,1) + v(2,2)*v(6,1)*v(7,2) + v(2,2)*v(6,2)*v(7,1) + v(3,1)*v(4,2)*v(8,2) - v(3,1)*v(5,2)*v(7,2) + v(3,2)*v(4,1)*v(8,2) + v(3,2)*v(4,2)*v(8,1) - v(3,2)*v(5,1)*v(7,2) - v(3,2)*v(5,2)*v(7,1) - v(1,2)*v(5,2)*v(9,2) + v(1,2)*v(6,2)*v(8,2) + v(2,2)*v(4,2)*v(9,2) - v(2,2)*v(6,2)*v(7,2) - v(3,2)*v(4,2)*v(8,2) + v(3,2)*v(5,2)*v(7,2);

    g = solve_cubic([c0 c1 c2 c3]);
    g = unique(g);
    v = g .* v(:,1) + (1 - g) .* v(:,2);

    % xx = [x; y];
    % XX = [X; Y];
    for k = 1:size(v,2)
        f = v(:,k);
        F(:,:,k) = reshape(f,3,3)';
        F(:,:,k) = Tx' * F(:,:,k) * TX;
        [U,s,V] = svd(F(:,:,k)');
        c(1,k) = V(1,end)./V(3,end);
        c(2,k) = V(2,end)./V(3,end);
        v(:,k) = reshape(F(:,:,k)',[],1);
        H(:,:,k) = reshape([v(4:6,k); -v(1:3,k)],3,2)';
        % if mean(diag([xx;ones(1,7)]' * F(:,:,k) * [XX;ones(1,7)])') > 1
        %     keyboard
        % end
    end

    if nargout >= 4
        r11 = v(4,:);
        r12 = v(5,:);
        r21 = -v(1,:);
        r22 = -v(2,:);

        A = r11.*r21 + r12.*r22;
        B = r11.^2 - r21.^2 + r12.^2 - r22.^2;
        r23 = [sqrt((B - sqrt(B.^2+4*A.^2))/2)...
            -sqrt((B - sqrt(B.^2+4*A.^2))/2)...
            sqrt((B + sqrt(B.^2+4*A.^2))/2)...
            -sqrt((B + sqrt(B.^2+4*A.^2))/2)];
        r13 = - repmat(A,1,4) ./ r23;

        r11 = repmat(r11,1,4);
        r12 = repmat(r12,1,4);
        r21 = repmat(r21,1,4);
        r22 = repmat(r22,1,4);
        c = repmat(c,1,4);
        v = repmat(v,1,4);

        realidx = abs(imag(r23))<1e-7;
        r11 = r11(realidx);
        r12 = r12(realidx);
        r21 = r21(realidx);
        r22 = r22(realidx);
        r13 = real(r13(realidx));
        r23 = real(r23(realidx));
        c = c(:,realidx);
        v = v(:,realidx);

        t = [v(6,:); -v(3,:)];

        s1 = 1./sqrt(r11.^2 + r12.^2 + r13.^2);
        s2 = -1./sqrt(r11.^2 + r12.^2 + r13.^2);

        r11 = [r11.*s1 r11.*s2];
        r12 = [r12.*s1 r12.*s2];
        r13 = [r13.*s1 r13.*s2];
        r21 = [r21.*s1 r21.*s2];
        r22 = [r22.*s1 r22.*s2];
        r23 = [r23.*s1 r23.*s2];
        t = [t.*s1 t.*s2];
        c = repmat(c,1,2);

        r1 = [r11' r12' r13'];
        r2 = [r21' r22' r23'];
        r3 = cross(r1',r2')';

        R = [reshape(r1',1,3,[]);...
            reshape(r2',1,3,[]);...
            reshape(r3',1,3,[])];
    end
end